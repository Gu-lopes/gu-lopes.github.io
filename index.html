<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Tracker</title>
    <style>
        /* Mesmos estilos que você já tem */
    </style>
</head>
<body>
    <header>
        <h1>Financial Tracker</h1>
    </header>
    <div class="container">
        <section class="summary">
            <div>
                <h2>Saldo Total</h2>
                <p id="total-balance">R$ 0,00</p>
            </div>
            <div>
                <h2>Receitas</h2>
                <p id="total-income">R$ 0,00</p>
            </div>
            <div>
                <h2>Despesas</h2>
                <p id="total-expenses">R$ 0,00</p>
            </div>
        </section>
        <button onclick="addTransaction()">Adicionar Transação</button>
        <table class="transactions-table">
            <thead>
                <tr>
                    <th>Data</th>
                    <th>Descrição</th>
                    <th>Categoria</th>
                    <th>Valor</th>
                </tr>
            </thead>
            <tbody id="transactions-body">
                <tr>
                    <td colspan="4">Carregando...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        const GITHUB_API_URL = 'https://api.github.com/repos/gu-lopes/finance-tracker-data/contents/transactions.json';
        const GITHUB_TOKEN = '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';

        let transactions = [];

        async function fetchTransactions() {
            const response = await fetch(GITHUB_API_URL, {
                headers: {
                    Authorization: `token ${GITHUB_TOKEN}`,
                },
            });
            const data = await response.json();
            const content = atob(data.content);
            transactions = JSON.parse(content);
            updateUI();
        }

        async function saveTransactions() {
            const response = await fetch(GITHUB_API_URL, {
                method: 'PUT',
                headers: {
                    Authorization: `token ${GITHUB_TOKEN}`,
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: 'Atualizando transações',
                    content: btoa(JSON.stringify(transactions)),
                    sha: await getSHA(),
                }),
            });
            if (!response.ok) {
                alert('Erro ao salvar transações no GitHub.');
            }
        }

        async function getSHA() {
            const response = await fetch(GITHUB_API_URL, {
                headers: {
                    Authorization: `token ${GITHUB_TOKEN}`,
                },
            });
            const data = await response.json();
            return data.sha;
        }

        function updateUI() {
            const tbody = document.getElementById('transactions-body');
            tbody.innerHTML = transactions.map(transaction => `
                <tr>
                    <td>${transaction.date}</td>
                    <td>${transaction.description}</td>
                    <td>${transaction.category}</td>
                    <td>R$ ${transaction.value.toFixed(2)}</td>
                </tr>
            `).join('') || '<tr><td colspan="4">Nenhuma transação registrada</td></tr>';

            const totalIncome = transactions.filter(t => t.value > 0).reduce((sum, t) => sum + t.value, 0);
            const totalExpenses = transactions.filter(t => t.value < 0).reduce((sum, t) => sum + Math.abs(t.value), 0);
            document.getElementById('total-income').textContent = `R$ ${totalIncome.toFixed(2)}`;
            document.getElementById('total-expenses').textContent = `R$ ${totalExpenses.toFixed(2)}`;
            document.getElementById('total-balance').textContent = `R$ ${(totalIncome - totalExpenses).toFixed(2)}`;
        }

        function addTransaction() {
            const newTransaction = {
                date: prompt('Data (YYYY-MM-DD):'),
                description: prompt('Descrição:'),
                category: prompt('Categoria:'),
                value: parseFloat(prompt('Valor:')),
            };
            transactions.push(newTransaction);
            saveTransactions();
            updateUI();
        }

        fetchTransactions();
    </script>
</body>
</html>
